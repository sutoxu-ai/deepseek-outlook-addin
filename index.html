<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>DeepSeek 助手</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js"></script>
</head>
<body>
  <div id="summary">正在生成摘要...</div>
  <script>
    Office.onReady(() => {
      // 仅在撰写邮件时运行
      if (Office.context.mailbox.item && Office.context.mailbox.item.body) {
        Office.context.mailbox.item.body.getAsync("text", (result) => {
          const subject = Office.context.mailbox.item.subject || "无主题";
          const body = result.value || "";

          fetch("https://deepseek-proxy-seven.vercel.app/api/ai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ subject, body })
          })
          .then(res => res.json())
          .then(data => {
            document.getElementById("summary").innerText = data.summary || "生成失败";
          })
          .catch(err => {
            document.getElementById("summary").innerText = "网络错误: " + err.message;
          });
        });
      }
    });
  </script>
</body>
</html>
